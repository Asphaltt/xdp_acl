(window.webpackJsonp=window.webpackJsonp||[]).push([["app"],{0:function(t,e,r){t.exports=r("56d7")},"034f":function(t,e,r){"use strict";r("85ec")},"390e":function(t,e,r){"use strict";r("8782")},"56d7":function(t,e,r){"use strict";r.r(e);r("e260"),r("e6cf"),r("cca6"),r("a79d");var a=r("2b0e"),s=(r("a434"),r("a15b"),r("caad"),r("d81d"),r("5319"),r("ac1f"),r("4d63"),r("25f0"),r("46a1"),r("450d"),r("e5f2")),i=r.n(s),l=(r("be4f"),r("896a")),o=r.n(l),n=(r("d3b7"),r("bc3a")),c=r.n(n),u={URL:"",timeInterval:4e3},d=c.a.create({baseURL:u.URL,timeout:5e3}),p=null;d.interceptors.request.use((function(t){return p=o.a.service({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0,0,0,0.7)"}),t}),(function(t){return console.log("====>",t),Promise.reject(t)})),d.interceptors.response.use((function(t){return p.close(),t}),(function(t){if(p.close(),console.log("====>",t.response),null==t.response)i.a.error({title:"错误",message:t});else{var e=t.response.data.msg;console.log("msg",t.response.data),i.a.error({title:"错误",message:e})}return Promise.reject(t)}));var f=d,m=(r("159b"),r("a9e3"),r("1276"),r("498a"),{name:"HelloWorld",props:["dialogFormVisible","tableData"],data:function(){var t=this,e=function(e,r,a){null==r?a(new Error("IP不可为空")):t.splitIpArray(r).length?a():a(new Error(t.splitIpArray(r).errText))},r=function(e,r,a){if(r.length){/^[\s\d]*$/.test(r)||a(new Error("存在无效字符"));var s=t.portFilter(r),i=[];s.forEach((function(t){(Number(t)<0||Number(t)>65535)&&a(new Error("端口超出范围")),i.includes(t)?a(new Error("端口重复")):i.push(t)})),a()}else a()};return{isICMP:!1,czfas:[{value:1,wsdFamc:"TCP",id:"TCP",disabled:!1},{value:2,wsdFamc:"UDP",id:"UDP",disabled:!1},{value:3,wsdFamc:"ICMP",id:"ICMP",disabled:!1}],form:{priority:"",strategy:2,protos:[],addr_src_arr:"",port_src_arr:"",addr_dst_arr:"",port_dst_arr:""},rules:{priority:[{required:!0,message:"请输入优先级",trigger:"blur"},{validator:function(e,r,a){Number(r)<1||Number(r)>10239?a(new Error("优先级范围:1~10239")):(t.tableData.forEach((function(t){Number(r)==t.priority&&a(new Error("优先级已存在"))})),a())},trigger:"blur"}],protos:[{type:"array",required:!0,message:"请至少选择一种协议"},{validator:function(t,e,r){e.length?r():r(new Error("请至少选择一种协议"))},trigger:"blur"}],addr_src_arr:[{validator:e,trigger:"blur"}],addr_dst_arr:[{validator:e,trigger:"blur"}],port_src_arr:[{validator:r,trigger:"blur"}],port_dst_arr:[{validator:r,trigger:"blur"}]},formLabelWidth:"120px"}},methods:{formSubmit:function(t){var e=this,r=!0;if(this.$refs[t].validate((function(t){console.log("开始验证表单数据"),console.log("------验证结果-----：",t),r=t,t||setTimeout((function(){document.getElementsByClassName("is-error")[0].querySelector("div").focus()}),1)})),!r)return!1;var a=JSON.parse(JSON.stringify(this.form)),s=0;a.protos.map((function(t){switch(t){case"TCP":s|=1;break;case"UDP":s|=2;break;case"ICMP":s|=4}})),a.protos=s,a.priority=Number(a.priority),a.port_src_arr=0==a.port_src_arr.length?[]:this.portFilter(a.port_src_arr),a.port_dst_arr=0==a.port_dst_arr.length?[]:this.portFilter(a.port_dst_arr),a.addr_src_arr=this.splitIpArray(a.addr_src_arr),a.addr_dst_arr=this.splitIpArray(a.addr_dst_arr),f.post("/xdp-acl/IPv4/rule",a).then((function(t){if(201===t.status){var r=Object.assign(t.data,{hitcount:0});e.$emit("formSubmit",r)}e.czfas.map((function(t){t.disabled=!1,e.isICMP=!1}))})).catch((function(t){console.log(t)}))},formCancel:function(){this.$emit("formCancel",!1)},splitIpArray:function(t){for(var e=t.trim().split(/\s+/),r=[],a=/^([0-9]{1,3}\.){3}[0-9]{1,3}(\/([0-9]|[1-2][0-9]|3[0-2]))?$/,s=0;s<e.length;s++){var i=e[s].split("/");if(i.length<2)return{errText:"IP不完整",state:!1};if(Number(i[2])>-1&&Number(i[2])<33)return{errText:"子网掩码超出范围",state:!1};if(!a.test(e[s]))return{errText:"第".concat(++s,"行IP格式错误"),state:!1};r.push({cidr_user:e[s]})}return r},portFilter:function(t){return t.trim().split(/\s+/).map(Number)}}}),_=(r("390e"),r("2877")),b={name:"acl",data:function(){return{height:0,tableData:{rules_arr:[],hitcount_arr:[]},dialogFormVisible:!1,isFirstLoad:!0,dialogDeletaRule:!1,deleteRuleObj:{}}},mounted:function(){var t=.65*window.outerHeight;console.log("BHright",t),this.height=t,this.getRules()},components:{addForm:Object(_.a)(m,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"addForm"},[r("el-dialog",{attrs:{title:"添加规则",visible:t.dialogFormVisible,"before-close":t.formCancel,top:"12vh",width:"520px","destroy-on-close":!0},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[r("el-form",{ref:"form",attrs:{model:t.form,rules:t.rules,"status-icon":"",inline:!0,size:"mini",id:"form-view","hide-required-asterisk":!0}},[r("el-form-item",{staticClass:"form-item-view form-item-little",attrs:{label:"优先级 :",prop:"priority",type:"number","label-width":t.formLabelWidth}},[r("el-input",{staticClass:"input-little",attrs:{type:"number"},nativeOn:{mousewheel:function(t){t.preventDefault()}},model:{value:t.form.priority,callback:function(e){t.$set(t.form,"priority",e)},expression:"form.priority"}})],1),r("el-form-item",{staticClass:"form-item-view form-item-little",attrs:{label:"策略 :","label-width":"50px"}},[r("el-select",{staticClass:"input-little",model:{value:t.form.strategy,callback:function(e){t.$set(t.form,"strategy",t._n(e))},expression:"form.strategy"}},[r("el-option",{attrs:{label:"允许",value:2}}),r("el-option",{attrs:{label:"拒绝",value:1}})],1)],1),r("el-form-item",{staticClass:"form-item-view",attrs:{prop:"protos",label:"协议类型 :","label-width":t.formLabelWidth}},[r("el-select",{staticClass:"one-line-select",attrs:{multiple:"",placeholder:"请选择",clearable:""},model:{value:t.form.protos,callback:function(e){t.$set(t.form,"protos",e)},expression:"form.protos"}},t._l(t.czfas,(function(t){return r("el-option",{key:t.value,attrs:{label:t.wsdFamc,value:t.id,disabled:t.disabled}})})),1)],1),r("div",{staticClass:"addr-ip-view"},[r("el-form-item",{staticClass:"form-item-view addr-ip-item",attrs:{label:"源 IP ：","label-width":t.formLabelWidth,prop:"addr_src_arr"}},[r("template",{slot:"label"},[r("span",{},[r("el-tooltip",{staticClass:"item",attrs:{effect:"light",placement:"top"}},[r("div",{attrs:{slot:"content"},slot:"content"},[r("p",{staticClass:"assist-text"},[t._v("• 0.0.0.0/0 表示所有 IP")]),r("p",{staticClass:"assist-text"},[t._v("• 多IP段需分行输入")])]),r("span",[t._v("源 IP "),r("i",{staticClass:"el-icon-warning-outline ico-pre",staticStyle:{"font-size":"10px"}})])])],1),t._v(" : ")]),r("el-input",{staticClass:"addr-ip-item-textarea",attrs:{type:"textarea",autocomplete:"off",placeholder:"123.123.123.123/24\n124.123.123.123/24"},model:{value:t.form.addr_src_arr,callback:function(e){t.$set(t.form,"addr_src_arr",e)},expression:"form.addr_src_arr"}})],2),r("el-form-item",{staticClass:"form-item-view addr-ip-item",attrs:{label:"目的 IP：","label-width":t.formLabelWidth,prop:"addr_dst_arr"}},[r("template",{slot:"label"},[r("span",{},[r("el-tooltip",{staticClass:"item",attrs:{effect:"light",placement:"top"}},[r("div",{attrs:{slot:"content"},slot:"content"},[r("p",{staticClass:"assist-text"},[t._v("• 0.0.0.0/0 表示所有 IP")]),r("p",{staticClass:"assist-text"},[t._v("• 多IP段需分行输入")])]),r("span",[t._v("目的 IP "),r("i",{staticClass:"el-icon-warning-outline ico-pre",staticStyle:{"font-size":"10px"}})])])],1),t._v(" : ")]),r("el-input",{staticClass:"addr-ip-item-textarea",attrs:{type:"textarea",autocomplete:"off",placeholder:"123.123.123.123/24\n124.123.123.123/24"},model:{value:t.form.addr_dst_arr,callback:function(e){t.$set(t.form,"addr_dst_arr",e)},expression:"form.addr_dst_arr"}})],2)],1),r("div",{staticClass:"addr-ip-view"},[r("el-form-item",{staticClass:"form-item-view addr-ip-item",attrs:{label:"源端口：","label-width":t.formLabelWidth,prop:"port_src_arr"}},[r("template",{slot:"label"},[r("span",{},[r("el-tooltip",{staticClass:"item",attrs:{effect:"light",placement:"top"}},[r("div",{attrs:{slot:"content"},slot:"content"},[r("p",{staticClass:"assist-text"},[t._v("• 端口范围 : 0~65535")]),r("p",{staticClass:"assist-text"},[t._v("• 多个端口用空格分割")]),r("p",{staticClass:"assist-text"},[t._v("• 空白不填表示所有端口")])]),r("span",[t._v("源端口 "),r("i",{staticClass:"el-icon-warning-outline ico-pre",staticStyle:{"font-size":"10px"}})])])],1),t._v(" : ")]),r("el-input",{staticClass:"addr-ip-item-textarea",attrs:{autocomplete:"off",placeholder:"1 60 80",disabled:t.isICMP},model:{value:t.form.port_src_arr,callback:function(e){t.$set(t.form,"port_src_arr",e)},expression:"form.port_src_arr"}})],2),r("el-form-item",{staticClass:"form-item-view addr-ip-item",attrs:{label:"目的端口：","label-width":t.formLabelWidth,prop:"port_dst_arr"}},[r("template",{slot:"label"},[r("span",{},[r("el-tooltip",{staticClass:"item",attrs:{effect:"light",placement:"top"}},[r("div",{attrs:{slot:"content"},slot:"content"},[r("p",{staticClass:"assist-text"},[t._v("• 端口范围 : 0~65535")]),r("p",{staticClass:"assist-text"},[t._v("• 多个端口用空格分割")]),r("p",{staticClass:"assist-text"},[t._v("• 空白不填表示所有端口")])]),r("span",[t._v("目的端口 "),r("i",{staticClass:"el-icon-warning-outline ico-pre",staticStyle:{"font-size":"10px"}})])])],1),t._v(" : ")]),r("el-input",{staticClass:"addr-ip-item-textarea",attrs:{autocomplete:"off",placeholder:"1 60 80",disabled:t.isICMP},model:{value:t.form.port_dst_arr,callback:function(e){t.$set(t.form,"port_dst_arr",e)},expression:"form.port_dst_arr"}})],2)],1)],1),r("div",{staticClass:"dialog-footer",staticStyle:{"margin-right":"55px","padding-top":"0"},attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"mini",plain:""},on:{click:t.formCancel}},[t._v("取 消")]),r("el-button",{staticStyle:{"margin-left":"25px"},attrs:{type:"primary",size:"mini",plain:""},on:{click:function(e){return t.formSubmit("form")}}},[t._v("确 定")])],1)],1)],1)}),[],!1,null,null,null).exports},watch:{"tableData.rules_arr":function(){}},methods:{getRules:function(){var t=this;f.get("/xdp-acl/IPv4/rules").then((function(e){200===e.status&&(t.$set(t.tableData,"rules_arr",e.data),t.getHitcount())})).catch((function(t){console.log("err",t)}))},getHitcount:function(){var t=this;c.a.get(u.URL+"/xdp-acl/IPv4/rules/hitcount").then((function(e){200===e.status&&(t.hitcount_arr=e.data,t.mergeRulesHits()),setTimeout((function(){t.getHitcount()}),u.timeInterval)})).catch((function(e){console.log(e),setTimeout((function(){t.getHitcount()}),u.timeInterval)}))},handleDelete:function(t){this.dialogDeletaRule=!0,this.deleteRuleObj=t},deleteRule:function(){var t=this,e=this.deleteRuleObj.row.priority,r=this.deleteRuleObj.rowIndex;f.delete("/xdp-acl/IPv4/rule"+"?priority=".concat(e)).then((function(a){200===a.status&&(t.$notify({title:"成功",message:"规则: ".concat(e," 删除成功"),type:"success",duration:3e3}),t.tableData.rules_arr.splice(r,1),t.dialogDeletaRule=!1)})).catch((function(t){console.log(t)}))},formSubmit:function(t){this.tableData.rules_arr.unshift(this.tableDataFormat(t)),this.dialogFormVisible=!1,this.$notify({title:"提示",message:"规则： ".concat(t.priority," 添加成功"),type:"success",duration:2e3})},formCancel:function(){this.dialogFormVisible=!1},deleteCancel:function(){this.dialogDeletaRule=!1},tableDataFormat:function(t){var e=t;e.strategy=1==e.strategy?"拒绝":"允许";var r=[];(1&e.protos)>0&&r.push("TCP"),(e.protos>>1&1)>0&&r.push("UDP"),(e.protos>>2&1)>0&&r.push("ICMP"),e.protos=r.join(" ");var a=r.includes("ICMP")&&1==r.length;return e.port_src_arr=this.portFilter(e.port_src_arr,a),e.port_dst_arr=this.portFilter(e.port_dst_arr,a),e.create_time=this.format(new Date(e.create_time),"yyyy-MM-dd hh:mm:ss"),e},mergeRulesHits:function(){for(var t=this,e={},r=0;r<this.hitcount_arr.length;r++)e[this.hitcount_arr[r].priority]=this.hitcount_arr[r];for(var a=0;a<this.tableData.rules_arr.length;a++)null!=e[this.tableData.rules_arr[a].priority]&&this.$set(this.tableData.rules_arr[a],"hitcount",BigInt(e[this.tableData.rules_arr[a].priority].hit_count));this.isFirstLoad&&(this.tableData.rules_arr.map((function(e){t.tableDataFormat(e)})),this.isFirstLoad=!1)},portFilter:function(t,e){return e?"-":t.length?t:"ALL"},format:function(t,e){var r=new Date(t),a={"M+":r.getMonth()+1,"d+":r.getDate(),"h+":r.getHours(),"m+":r.getMinutes(),"s+":r.getSeconds(),"q+":Math.floor((r.getMonth()+3)/3),S:r.getMilliseconds()};for(var s in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(r.getFullYear()+"").substr(4-RegExp.$1.length))),a)new RegExp("("+s+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?a[s]:("00"+a[s]).substr((""+a[s]).length)));return e}}},g=(r("034f"),Object(_.a)(b,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{attrs:{id:"app"}},[r("el-button",{staticClass:"addButton",attrs:{type:"primary",size:"small",plain:""},on:{click:function(e){t.dialogFormVisible=!0}}},[t._v("添加规则")]),r("ux-grid",{ref:"rulesTable",staticStyle:{"font-size":"12px"},attrs:{data:t.tableData.rules_arr,"row-class-name":"tableRowClassName","cell-class-name":"tablCellClassName",size:"small","header-cell-style":{background:"#f5f7fa",color:"#606266"},fit:!0,stripe:"",height:t.height,border:!1,sortConfig:{trigger:"cell",orders:["asc","desc","null"]}}},[r("ux-table-column",{attrs:{field:"priority",title:"优先级",sortable:!0,align:"center",width:"80px"}}),r("ux-table-column",{attrs:{field:"strategy",title:"策略",width:"60px",align:"center"}}),r("ux-table-column",{attrs:{field:"protos",title:"协议类型",align:"center"}}),r("ux-table-column",{attrs:{field:"addr_src.cidr_user",title:"源 IP","show-overflow-tooltip":!1,width:"140px",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return t._l(e.row.addr_src_arr,(function(e,a){return r("el-tooltip",{key:a,attrs:{placement:"top-start",effect:"light"}},[r("div",{attrs:{slot:"content"},slot:"content"},[t._v("生效："+t._s(e.cidr_standard))]),r("p",{staticClass:"dst_text",staticStyle:{cursor:"pointer"}},[t._v(" "+t._s(e.cidr_user)+" ")])])}))}}])}),r("ux-table-column",{attrs:{field:"port_src_arr",title:"源端口",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.port_src_arr.length>0&&Array.isArray(e.row.port_src_arr)?r("div",{staticClass:"port-view"},t._l(e.row.port_src_arr,(function(e,a){return r("span",{key:a,staticClass:"port-span"},[t._v(t._s(e)+" ")])})),0):r("div",[t._v(t._s(e.row.port_src_arr))])]}}])}),r("ux-table-column",{attrs:{title:"目的 IP",width:"140px",align:"center","show-overflow-tooltip":!1},scopedSlots:t._u([{key:"default",fn:function(e){return t._l(e.row.addr_dst_arr,(function(e,a){return r("el-tooltip",{key:a,attrs:{placement:"top-start",effect:"light"}},[r("div",{attrs:{slot:"content"},slot:"content"},[t._v("生效："+t._s(e.cidr_standard))]),r("p",{staticClass:"dst_text",staticStyle:{cursor:"pointer"}},[t._v(" "+t._s(e.cidr_user)+" ")])])}))}}])}),r("ux-table-column",{attrs:{field:"port_dst_arr",title:"目的端口",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.port_dst_arr.length>0&&Array.isArray(e.row.port_dst_arr)?r("div",{staticClass:"port-view"},t._l(e.row.port_dst_arr,(function(e,a){return r("span",{key:a,staticClass:"port-span"},[t._v(t._s(e)+" ")])})),0):r("div",[t._v(t._s(e.row.port_dst_arr))])]}}])}),r("ux-table-column",{attrs:{field:"hitcount",title:"命中次数",sortable:"",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[r("span",[t._v(t._s(e.row.hitcount))])]}}])}),r("ux-table-column",{attrs:{field:"create_time",title:"创建时间",width:"160px",sortable:"",align:"center"}}),r("ux-table-column",{attrs:{field:"",title:"操作",width:"100px",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[r("el-button",{attrs:{type:"text",size:"mini",disabled:null!=e.row.can_not_del&&1==e.row.can_not_del},on:{click:function(r){return t.handleDelete(e)}}},[t._v("删除")])]}}])})],1),t.dialogFormVisible?r("addForm",{attrs:{"dialog-form-visible":t.dialogFormVisible,"table-data":t.tableData.rules_arr},on:{formSubmit:t.formSubmit,formCancel:t.formCancel}}):t._e(),r("div",{staticClass:"Dialogdeleta"},[t.dialogDeletaRule?r("el-dialog",{attrs:{title:"提示",width:"420px",visible:t.dialogDeletaRule},on:{"update:visible":function(e){t.dialogDeletaRule=e}}},[r("p",[t._v("确定要删除优先级为 "+t._s(t.deleteRuleObj.row.priority)+" 的规则吗？")]),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"mini",plain:""},on:{click:t.deleteCancel}},[t._v("取 消")]),r("el-button",{staticStyle:{"margin-left":"25px"},attrs:{type:"primary",size:"mini",plain:""},on:{click:function(e){return t.deleteRule()}}},[t._v("确 定")])],1)]):t._e()],1)],1)}),[],!1,null,null,null).exports),h=(r("9e1f"),r("6ed5")),v=r.n(h),y=(r("cbb5"),r("8bbc")),w=r.n(y),x=(r("f3e4"),r("9dda")),C=r.n(x),I=(r("aaa5"),r("a578")),P=r.n(I),D=(r("eca7"),r("3787")),k=r.n(D),F=(r("425f"),r("4105")),R=r.n(F),S=(r("0c67"),r("299c")),$=r.n(S),E=(r("5466"),r("ecdf")),z=r.n(E),L=(r("38a0"),r("ad41")),M=r.n(L),N=(r("1951"),r("eedf")),j=r.n(N),T=(r("9d4c"),r("e450")),O=r.n(T),A=(r("3db2"),r("58b8")),H=r.n(A),V=(r("f4f9"),r("c2cc")),U=r.n(V),W=(r("7a0f"),r("0f6c")),q=r.n(W),B=(r("a7cc"),r("df33")),J=r.n(B),Y=(r("10cb"),r("f3ad")),G=r.n(Y),K=(r("016f"),r("486c")),Q=r.n(K),X=(r("6611"),r("e772")),Z=r.n(X),tt=(r("1f1a"),r("4e4b")),et=r.n(tt),rt={install:function(t){t.use(et.a),t.use(Z.a),t.use(Q.a),t.use(G.a),t.use(J.a),t.use(q.a),t.use(U.a),t.use(H.a),t.use(O.a),t.use(j.a),t.use(M.a),t.use(z.a),t.use($.a),t.use(R.a),t.use(k.a),t.use(P.a),t.use(C.a),t.use(w.a),t.prototype.$loading=o.a.service,t.prototype.$confirm=v.a.confirm,t.prototype.$notify=i.a}},at=(r("0fae"),r("299f")),st=r.n(at);r("4ba7");a.default.config.productionTip=!1,a.default.use(rt),a.default.use(st.a),new a.default({render:function(t){return t(g)}}).$mount("#app")},"85ec":function(t,e,r){},8782:function(t,e,r){}},[[0,"runtime","npm.xe-utils","npm.core-js","npm.element-ui","npm.babel-runtime","npm.axios","npm.async-validator","npm.umy-table","npm.umy-ui","npm.resize-observer-polyfill","npm.sortablejs","npm.vue","npm.vuedraggable","vendors~app"]]]);